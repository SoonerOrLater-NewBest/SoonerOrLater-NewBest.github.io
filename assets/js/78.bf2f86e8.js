(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{656:function(s,n,a){"use strict";a.r(n);var t=a(45),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[s._v("#")]),s._v(" "),a("Label",{attrs:{level:3}}),s._v("Nginx")],1),s._v(" "),a("p",[s._v("Nginx 是一款广泛应用的 Web 服务器，常用于反向代理、负载均衡器以及 HTTP 缓存等。")]),s._v(" "),a("h2",{attrs:{id:"使用-nginx-服务为-linux-实例绑定多个域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-服务为-linux-实例绑定多个域名"}},[s._v("#")]),s._v(" 使用 Nginx 服务为 Linux 实例绑定多个域名")]),s._v(" "),a("blockquote",[a("p",[s._v("以 CentOS 6.8 为例")])]),s._v(" "),a("ol",[a("li",[s._v("登录 Linux 实例。")]),s._v(" "),a("li",[s._v("进入 Nginx 服务的配置文件目录，执行如下命令：")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("cd /etc/nginx/conf.d\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("创建域名规则配置文件，输入 i 编辑新建的配置文件。")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("vi [$Domain_Name].conf\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"为每一个域名建立一个单独的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为每一个域名建立一个单独的配置文件"}},[s._v("#")]),s._v(" 为每一个域名建立一个单独的配置文件")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server\n{\nlisten   80;                    #监听端口设为80。\nserver_name  www.server110.com;      #绑定您的域名。\nindex index.htm index.html index.php;   #指定默认文件。\nroot /home/www/server110.com;        #指定网站根目录。\ninclude location.conf;            #当您需要调用其他配置文件时才粘贴此项，如无需要，请删除此项。\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h3",{attrs:{id:"将多个域名规则写进一个共同的配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将多个域名规则写进一个共同的配置文件"}},[s._v("#")]),s._v(" 将多个域名规则写进一个共同的配置文件")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server\n{\nlisten   80;                       #监听端口设为 80。\nserver_name  www.server110.com;         #绑定您的域名。\nindex index.htm index.html index.php;   #指定默认文件。\nroot /home/www/server110.com;           #指定网站根目录。\ninclude location.conf;                  #当您需要调用其他配置文件时才粘贴此项，如无需要，请删除此项。\n}\nserver\n{\nlisten   80;                            #监听端口设为 80。\nserver_name  msn.server111.com;         #绑定您的域名。\nindex index.htm index.html index.php;   #指定默认文件。\nroot /home/www/msn.server110.com;      #指定网站根目录。\ninclude location.conf;             #当您需要调用其他配置文件时才粘贴此项，如无需要，请删除此项。\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h3",{attrs:{id:"为无-www-前缀的域名配置规则，并添加-301-跳转"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#为无-www-前缀的域名配置规则，并添加-301-跳转"}},[s._v("#")]),s._v(" 为无 WWW 前缀的域名配置规则，并添加 301 跳转")]),s._v(" "),a("div",{staticClass:"language-conf line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("server\n{\nlisten 80;\nserver_name server110.com;\nrewrite ^/(.*) http://www.server110.com/$1 permanent;\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("按 Esc 键退出编辑，输入"),a("code",[s._v(":wq")]),s._v("，保存并退出。")]),s._v(" "),a("li",[s._v("执行"),a("code",[s._v("nginx -t")]),s._v("命令，检查配置是否有误，并按照报错提示修复错误。")]),s._v(" "),a("li",[a("code",[s._v("service nginx restart")]),s._v("，重启 Nginx 服务。")]),s._v(" "),a("li",[a("code",[s._v("service nginx reload")]),s._v("，重新载入 Nginx 服务。")])]),s._v(" "),a("h2",{attrs:{id:"使用-nginx-反向代理-nodejs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-nginx-反向代理-nodejs"}},[s._v("#")]),s._v(" 使用 Nginx 反向代理 Nodejs")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("upstream node1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nupstream node2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3001")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nunderscores_in_headers on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmap $http_my_header $pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dev1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    condition1 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    condition2 "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node2"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    listen "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server_name xxxxxxxxxxxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    access_log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("nginx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("xxx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("log"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate 你的证书"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate_key 你的key\n    ssl_session_timeout "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_protocols TLSv1 TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" TLSv1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    location "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("$pool"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        proxy_set_header "),a("span",{pre:!0,attrs:{class:"token constant"}},[s._v("X")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("NginX"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Proxy "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("ul",[a("li",[s._v("从上面的 conf 中，有 2 个分别监听 3000 和 3001 端口的"),a("code",[s._v("nodejs")]),s._v("应用")]),s._v(" "),a("li",[a("code",[s._v("underscores_in_headers")]),s._v(" 默认为"),a("code",[s._v("off")]),s._v(" 意思就是如果你的头部有下划线就忽略掉，那么很显然我不想忽略所以设置成 on")]),s._v(" "),a("li",[a("code",[s._v("map $http_my_header $pool")]),s._v("根据请求头来访问不同的"),a("code",[s._v("nodejs")]),s._v("服务")]),s._v(" "),a("li",[s._v("最后就是配置 server 然后监听 https 的默认端口")]),s._v(" "),a("li",[s._v("输入 "),a("code",[s._v("nginx -t")]),s._v(" 测试一下，ok 的话就可以 "),a("code",[s._v("service nginx reload")]),s._v(" 重新载入。")])])])}),[],!1,null,null,null);n.default=e.exports}}]);